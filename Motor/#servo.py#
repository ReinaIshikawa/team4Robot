#!/usr/bin/env python
# -*- coding: utf-8 -*-
import Adafruit_PCA9685
import time

# サーボモーターをコントロールするためのクラス
class servo_Class:
    #ChannelはPCA9685のサーボモーターを繋いだチャンネル
    #ZeroOffsetはサーボモーターの基準の位置を調節するためのパラメーターです
    def __init__(self, Channel, ZeroOffset):
        self.mChannel = Channel
        self.mZeroOffset = ZeroOffset

        #Adafruit_PCA9685の初期化
        self.pwm = Adafruit_PCA9685.PCA9685(address=0x40)
        self.pwm.set_pwm_freq(60)

        
    """角度を設定する関数です"""
    def SetPos(self, pos):
        pulse = (650-150)/180*pos+150+self.ZeroOffset
        pulse=int(pulse)
        print("in set pos ", pos)
        self.pwm.set_pwm(self.Channel,0,pulse)

        
"""制御を行うメインの部分です"""
if __name__ == '__main__':
#今回はサーボモーターが3つあります
    Servo0 = servo_Class(Channel=0, ZeroOffset=-5)
    try:
        #テストでそれぞれのサーボモーターを45度,90度と繰り返し動かしてみます。
        while True:
            print('45')
            Servo0.SetPos(45)
            time.sleep(2)          
            print('90')
            Servo0.SetPos(90)
            time.sleep(2)
    except KeyboardInterrupt :         #Ctl+Cが押されたらループを終了
        print("\nCtl+C")
    except Exception as e:
        print(str(e))


def rotate(start, end):
    Servo0 = servo_Class(Channel=0, ZeroOffset=-5)    
    try:
        if start > 0:
            while True:
                Servo0.SetPos(start)
                Servo0.SetPos(end)
    except KeyboardInterrupt:
        print("\nCtl+C")
    except Exception as e:
        print(str(e))
